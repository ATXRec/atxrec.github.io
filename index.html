<!DOCTYPE html>
<html>
  <head>

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta charset="utf-8">

    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#c1f0c1">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-status-bar-style" content="#c1f0c1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

    <title>ATX Recreations Map</title>

    <link rel="icon" href="https://i.imgur.com/Sq7ZWl4.png">

    <style>
    #map {
      height: 100%;
    }

    body, html {
      height: calc(100% - 27px);
    }

    .navbar {
        margin-bottom: 0px;
        height: auto;
        background-color: #F2F3F4;
    }

    #navbar {
      font-size: 90%;
    }

    #locsearch {
      padding-right: 6px;
    }

    #dropdown {
      padding-right: 0px;
    }

    #dropdown-menu {
      font-size: 95%;
      padding: 8px;
      background: #F2F3F4;
      max-width: 184px;
      margin-top: 7px;
    }

    #dropdown-item {
      padding-left: 2px;
      padding-right: 2px;
    }

    #dropdown-pills {
      padding-top: 5px;
    }

    #dropdown-pills > li > a.active {
      background-color: #e6e6e6;
    }

    #dropdown-pills-top > li > a.active {
      background-color: #e6e6e6;
    }

    </style>
  </head>
  <body>



<nav class="navbar navbar-light", id="navbar">
  <div class="d-flex justify-content-between">
    <ul class="nav nav-pills">
      <li class="nav-item">
        <a class="nav-link active" href="#">Map</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/calendar">Calendar</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/about">About</a>
      </li>
    </ul>
    <ul class="nav">
      <!--<form class="form-inline justify-content-end", id="locsearch">
        <input class="form-control" type="text" placeholder="Search">
      </form>-->
      <li class="nav-item dropdown", id="dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="" role="button" aria-haspopup="true" aria-expanded="false">Filter</a>
          <div class="dropdown-menu dropdown-menu-right", id="dropdown-menu">

            <ul class="nav nav-pills", id="dropdown-pills-top">
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-park')" id="dropdown-park"><img src="https://i.imgur.com/Sq7ZWl4.png" width="24"/></a>
              </li>
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-pool')" id="dropdown-pool"><img src="https://i.imgur.com/hWD3v5O.png" width="24"/></a>
              </li>
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-playground')" id="dropdown-playground"><img src="https://i.imgur.com/umsvfED.png" width="24"/></a>
              </li>
            </ul>

            <ul class="nav nav-pills", id="dropdown-pills">
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-splash')" id="dropdown-splash"><img src="https://i.imgur.com/tO61iV6.png" width="24"/></a>
              </li>
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-trail')" id="dropdown-trail"><img src="https://i.imgur.com/K7MTLyv.png" width="24"/></a>
              </li>
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-field')" id="dropdown-field"><img src="https://i.imgur.com/YmGq2KL.png" width="24"/></a>
              </li>
            </ul>

            <ul class="nav nav-pills", id="dropdown-pills">
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-museum')" id="dropdown-museum"><img src="https://i.imgur.com/Q657jYI.png" width="24"/></a>
              </li>
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-rec')" id="dropdown-rec"><img src="https://i.imgur.com/SMUpvya.png" width="24"/></a>
              </li>
              <li class="nav-item" id="dropdown-item">
                <a class="nav-link active" onclick="switchActive('dropdown-art')" id="dropdown-art"><img src="https://i.imgur.com/aTuN9dl.png" width="24"/></a>
              </li>
            </ul>

          </div>
      </li>

      <button type="button" onclick="initLocate()" class="btn btn-outline-info"><img src="icons/LocateIcon.ico" width="20"/></button>

    </ul>
  </div>
</nav>

<div class='contentarea' id='map'></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA8GUJpzCpqy_rXBs8slLThmErnqjieBn4&extension=.js"></script>
<script src="jscss/infobox.js"></script>
<link href="jscss/infobox.css" rel="stylesheet">
<script src="data/locations.js"></script>

<script>

var filtered_list = [];
function switchActive(id) {
  if ( document.getElementById(id).classList.contains("active") ) {
    document.getElementById(id).classList.toggle("active");
    filtered_list.push(id);
  } else {
    document.getElementById(id).classList.toggle("active");
    filtered_list.splice(id);
  };
  console.log(filtered_list)
  init()
}

  google.maps.event.addDomListener(window, "load", init);
  var map,
    markersArray = [];

  var locationlist = []

  if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
    icon_scale = 32
  } else {
    icon_scale = 42
  };

  function bindInfoWindow(marker, map, location) {
    google.maps.event.addListener(marker, "click", function() {
      function close(location) {
        location.ib.close();
        location.infoWindowVisible = false;
        location.ib = null;
        locationlist.shift();
      }

      if (location.infoWindowVisible === true) {
        close(location);
      } else {
        markersArray.forEach(function(loc, index) {
          if (loc.ib && loc.ib !== null) {
            close(loc);
          }
        });

        var boxText = document.createElement("div");
        boxText.style.cssText = "background: #fff;";
        boxText.classList.add("md-whiteframe-2dp");

        function buildPieces(location, el, part, icon) {
          if (location[part] === "") {
            return "";
          } else if (location.iw[part]) {
            switch (el) {
              case "photo":
                if (location.photo) {
                  return (
                    '<div class="iw-photo" style="background-image: url(' +
                    location.photo +
                    ');"></div>'
                  );
                } else {
                  return "";
                }
                break;
              case "iw-toolbar":
                return (
                  '<div class="iw-toolbar"><h3 class="md-subhead">' +
                  location.title +
                  "</h3></div>"
                );
                break;
              case "div":
                switch (part) {
                  case "email":
                    return (
                      '<div class="iw-details"><i class="material-icons" style="color:#4285f4;"><img src="icons/' +
                      icon +
                      '.svg"/></i><span><a href="mailto:' +
                      location.email +
                      '" target="_blank">' +
                      location.email +
                      "</a></span></div>"
                    );
                    break;
                  case "web":
                    return (
                      '<div class="iw-details"><i class="material-icons" style="color:#4285f4;"><img src="icons/' +
                      icon +
                      '.svg"/></i><span><a href="' +
                      location.web +
                      '" target="_blank">' +
                      location.web_formatted +
                      "</a></span></div>"
                    );
                    break;
                  case "desc":
                    return (
                      '<label class="iw-desc" for="cb_details"><input type="checkbox" id="cb_details"/><h3 class="iw-x-details">Details</h3><i class="material-icons toggle-open-details"><img src="icons/' +
                      icon +
                      '.svg"/></i><p class="iw-x-details">' +
                      location.desc +
                      "</p></label>"
                    );
                    break;
                  default:
                    return (
                      '<div class="iw-details"><i class="material-icons"><img src="icons/' +
                      icon +
                      '.svg"/></i><span>' +
                      location[part] +
                      "</span></div>"
                    );
                    break;
                }
                break;
              case "open_hours":
                var items = "";
                if (location.open_hours.length > 0) {
                  for (var i = 0; i < location.open_hours.length; ++i) {
                    if (i !== 0) {
                      items +=
                        "<li><strong>" +
                        location.open_hours[i].day +
                        "</strong><strong>" +
                        location.open_hours[i].hours +
                        "</strong></li>";
                    }
                    var first =
                      '<li><label for="cb_hours"><input type="checkbox" id="cb_hours"/><strong>' +
                      location.open_hours[0].day +
                      "</strong><strong>" +
                      location.open_hours[0].hours +
                      '</strong><i class="material-icons toggle-open-hours"><img src="icons/keyboard_arrow_down.svg"/></i><ul>' +
                      items +
                      "</ul></label></li>";
                  }
                  return (
                    '<div class="iw-list"><i class="material-icons first-material-icons" style="color:#4285f4;"><img src="icons/' +
                    icon +
                    '.svg"/></i><ul>' +
                    first +
                    "</ul></div>"
                  );
                } else {
                  return "";
                }
                break;
            }
          } else {
            return "";
          }
        }

        boxText.innerHTML =
          buildPieces(location, "photo", "photo", "") +
          buildPieces(location, "iw-toolbar", "title", "") +
          buildPieces(location, "div", "address", "location_on") +
          buildPieces(location, "div", "web", "public") +
          buildPieces(location, "div", "email", "email") +
          buildPieces(location, "div", "tel", "phone") +
          buildPieces(location, "div", "int_tel", "phone") +
          buildPieces(location, "open_hours", "open_hours", "access_time") +
          buildPieces(location, "div", "desc", "keyboard_arrow_down");

        var myOptions = {
          alignBottom: true,
          content: boxText,
          disableAutoPan: false,
          maxWidth: 0,
          pixelOffset: new google.maps.Size(-140, -icon_scale),
          zIndex: null,
          boxStyle: {
            opacity: 1,
            width: "280px"
          },
          closeBoxMargin: "0px 0px 0px 0px",
          infoBoxClearance: new google.maps.Size(1, 1),
          isHidden: false,
          pane: "floatPane",
          enableEventPropagation: false
        };

        location.ib = new InfoBox(myOptions);
        location.ib.open(map, marker);
        location.infoWindowVisible = true;
        //map.setCenter({lat: location.lat, lng: location.lng})

      // WORKS
      locationlist.push(location)
      close(locationlist[locationlist.length-2])
      }
    });
  }

  function init() {
    var mapOptions = {
      center: new google.maps.LatLng(30.26827752877251, -97.74217643718337),
      zoom: 13,
      gestureHandling: "auto",
      fullscreenControl: false,
      zoomControl: false,
      disableDoubleClickZoom: true,
      mapTypeControl: false,
      scaleControl: false,
      scrollwheel: true,
      streetViewControl: false,
      draggable: true,
      clickableIcons: false,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };

    var mapElement = document.getElementById("map");
    var map = new google.maps.Map(mapElement, mapOptions);

    // Check Filter
    filtered_urls = [];
    for (i = 0; i < filtered_list.length; i++) {
      if (filtered_list[i] == "dropdown-park") {
        filtered_urls.push("https://i.imgur.com/Sq7ZWl4.png")
      };
      if (filtered_list[i] == "dropdown-pool") {
        filtered_urls.push("https://i.imgur.com/hWD3v5O.png")
      };
      if (filtered_list[i] == "dropdown-playground") {
        filtered_urls.push("https://i.imgur.com/umsvfED.png")
      };
      if (filtered_list[i] == "dropdown-splash") {
        filtered_urls.push("https://i.imgur.com/tO61iV6.png")
      };
      if (filtered_list[i] == "dropdown-trail") {
        filtered_urls.push("https://i.imgur.com/K7MTLyv.png")
      };
      if (filtered_list[i] == "dropdown-field") {
        filtered_urls.push("https://i.imgur.com/YmGq2KL.png")
      };
      if (filtered_list[i] == "dropdown-museum") {
        filtered_urls.push("https://i.imgur.com/Q657jYI.png")
      };
      if (filtered_list[i] == "dropdown-rec") {
        filtered_urls.push("https://i.imgur.com/SMUpvya.png")
      };
      if (filtered_list[i] == "dropdown-art") {
        filtered_urls.push("https://i.imgur.com/aTuN9dl.png")
      };
    };

    for (i = 0; i < locations.length; i++) {

      var skip = false;
      for (n = 0; n < filtered_urls.length; n++) {
        if (locations[i].marker == filtered_urls[n]) {
          var skip = true;
        }
      };

      if (skip == false) {
      // vv Icon scaling
      var icon = {
        url: locations[i].marker, // url
        scaledSize: new google.maps.Size(icon_scale, icon_scale)
      }; // scaled size
      marker = new google.maps.Marker({
        icon: icon,
        // ^^ Icon scaling
        position: new google.maps.LatLng(locations[i].lat, locations[i].lng),
        map: map,
        title: locations[i].title,
        address: locations[i].address,
        desc: locations[i].desc,
        tel: locations[i].tel,
        int_tel: locations[i].int_tel,
        vicinity: locations[i].vicinity,
        open: locations[i].open,
        open_hours: locations[i].open_hours,
        photo: locations[i].photo,
        time: locations[i].time,
        email: locations[i].email,
        web: locations[i].web,
        iw: locations[i].iw
      });
      }

      markersArray.push(marker);

      if (locations[i].iw.enable === true) {
        bindInfoWindow(marker, map, locations[i]);
      };
    };
  }


  function initLocate() {
    var mapOptions = {
      center: new google.maps.LatLng(30.26827752877251, -97.74217643718337),
      zoom: 13,
      gestureHandling: "auto",
      fullscreenControl: false,
      zoomControl: false,
      disableDoubleClickZoom: true,
      mapTypeControl: false,
      scaleControl: false,
      scrollwheel: true,
      streetViewControl: false,
      draggable: true,
      clickableIcons: false,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var mapElement = document.getElementById("map");
    var map = new google.maps.Map(mapElement, mapOptions);
    for (i = 0; i < locations.length; i++) {
      // vv Icon scaling
      var icon = {
        url: locations[i].marker, // url
        scaledSize: new google.maps.Size(icon_scale, icon_scale)
      }; // scaled size
      marker = new google.maps.Marker({
        icon: icon,
        // ^^ Icon scaling
        position: new google.maps.LatLng(locations[i].lat, locations[i].lng),
        map: map,
        title: locations[i].title,
        address: locations[i].address,
        desc: locations[i].desc,
        tel: locations[i].tel,
        int_tel: locations[i].int_tel,
        vicinity: locations[i].vicinity,
        open: locations[i].open,
        open_hours: locations[i].open_hours,
        photo: locations[i].photo,
        time: locations[i].time,
        email: locations[i].email,
        web: locations[i].web,
        iw: locations[i].iw
      });
      markersArray.push(marker);
      if (locations[i].iw.enable === true) {
        bindInfoWindow(marker, map, locations[i]);
      };
    };
    // GEOLOCATION START
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        var pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
        map.setCenter(pos);
        map.setZoom(14);
        var locations1 = [
          {
            marker: "https://i.imgur.com/DnoLNQk.png",
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            iw: {
              address: true,
              desc: true,
              email: true,
              enable: true,
              int_tel: false,
              open: true,
              open_hours: true,
              photo: true,
              tel: false,
              title: true,
              web: true
            }
          }
        ];;
        for (i = 0; i < locations1.length; i++) {
          // vv Icon scaling
          var icon = {
            url: locations1[i].marker, // url
            scaledSize: new google.maps.Size(18, 18)
          }; // scaled size
          // ^^ Icon scaling
          marker = new google.maps.Marker({
            icon: icon,
            position: new google.maps.LatLng(
              position.coords.latitude,
              position.coords.longitude
            ),
            map: map,
            title: "You"
          });
          markersArray.push(marker);
        }
      })
    }
    // GEOLOCATION END
  }
</script>


<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>



  </body>
</html>
